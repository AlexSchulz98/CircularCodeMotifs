---
title: "On Mutations in Circular Code Motifs"
output: html_notebook
---


## Coding Sequence
Die Coding Sequenz (CDS) S ist eine RNA Sequenz mit Circular Code und Nicht-Circular-Code Motiven. Die Länge der Circular-Code-Motive soll maximiert werden.

## Circular Codes
Codes.c3 umfasst 216 selbst-komplementäre C3 Codes, welche als vielversprechend gelten. Unter diesen 216 Codes sind auch solche, welche Stopp-Codons enthalten, welche zu einem Abbruch beim Lesen des RNA Strangs führen. Mathematisch gesehen sind diese Codes gleichzusetzten mit den Stopp-Codon freien Codes, biologisch gesehen sind diese aber nicht sinnvoll zu verwenden, weshalb wir nur Stopp-Codon freie Codes verwenden.

## Methoden

### Randbedingungen

Es wird stets versucht die gleiche Aminosäure zu erhalten. Wenn dies nicht möglich ist, wird diese durch die an den biochemischen Eigenschaften gemessen ähnlichste Aminosäure ersetzt. Dazu dient die BLOSUM 62 Matrix.

Die Anzahl an Veränderungen bei einer Mutation soll in jedem Fall möglichst gering sein. 
Gibt es bei einer Punktmutation meherere Möglichkeiten wird auf die Eigenschafte der Base geachtet. Damit ist gemeint, dass eine Base des gleichen Typs, in Bezug auf Purin (A,G) oder Pyrimidin (C, T) soll bevorzugt diese für die Substitution genutzt werden.
Bei einem gleichen Score beim Austausch von Aminosäuren wird über die GCM Matrix von Doolitle aus dem Jahr 1981, diejenige ausgesucht, dessen Wert (in diesem Falls dessen Anzahl der Punktmutationen) geringer ist.

### Richtung
Zunächst wird betrachtet wie viele Schritte von biologischen zu einer zirkulären Sequenz gebraucht werden.

Danach betrachten wir die Veränderung von zirküläre in biologische Sequenzen.

### Vorgehen
Von Interesse sind nur Codons, welche nicht Teil des circular codes sind. 

```{r}
library(Biostrings)
library(ccmotif)
source("ChangeCodons.R")

seqSet = readDNAStringSet("cds/ena-sars.fasta") # RNA sequence set
seq=seqSet[[11]] #Single RNA sequence
codons = codons(seq) # List of codons in rnaseq

setX = codes.c3[[26]] #Circular Code
setX

for (entry in 1:length(codons)) {
  if (!partOfCircularCode(codons[[entry]],setX)) {
    translate(codons[[entry]])
    codonsForAminoAcid = getCodesForAA()
    }


  
}
```
Diese werden in die entsprechende Aminosäure übersetzt.
Mit der gefundenen Aminosäure lässt sich eine Liste von Codons zurückgeben, welche ebenfalls für diese Aminosäure codieren.

```{r}

codesForaa = getCodesForAA(aa)
print(codesForaa)
```

Es wird das Codon gesucht, welches auch Teil des Circular Codes ist. Wird eines gefunden, wird das alte Codon, durch das neue circular code Codon ersetzt.
TODO: Ersatz mit geringster Veränderung wählen. Dazu evtl Liste neuer Funktion übergeben

```{r}
codesForaa_size = length(codesForaa)

if (!is.null(codesForaa)) { #Bei eines Stopp Codon, wird eine leere Liste zurückgegeben
  
    for (j in codesForaa_size) {
      testCodon = codesForaa[j]
    
      if (grepl(testCodon, setXString)) {
        #Ersatz gefunden
        print(paste("Ersatz gefunden: ", testCodon))
        break()
      }
    }
  }
```

Sollte in der Liste kein Codon vorhanden sein, welches dem Kriterium entspricht, so suchen wir nach einer möglichst ähnlichen Aminosäure. Diese Aminosäure muss durch die Circular Codes codiert werden. Dazu lassen wir uns eine Liste dieser ausgeben:

```{r}
setXaa = translate(setXDNAString)
setXaa = uniqueLetters(setXaa)
print(setXaa)
```

Nun vergleichen wir die Aminosäure des Codons mit dieser Liste. Die Aminosäure mit der höchsten Übereinstimmung wird als Ersatz übernommen. 

TODO: Austausch werten

```{r}
data("BLOSUM62")
setXaa_length = length(setXaa)

#aaString = "P"

newAA = aaString # sollte sich keine Aminosäure mit score > 0 finden, wird die alte beibehalten
score = -5 # threshold

for (i in 1:setXaa_length) {
  tmp = BLOSUM62[aaString, setXaa[i]]
  if (tmp >= score) {
    score = tmp
    newAA = setXaa[i]
  }
}
print(paste(newAA, score))

```

Für die ganze Sequenz S ergibt sich folgendes: 

```{r}
newSequence = changeSequence(seq, setX)

print(setX) #circular code
print(toString(seq)) #oldSequence
print(newSequence)

counts = getStatistics()
print(paste("Insgesamt gab es", counts[1],"Codons."))
print(paste(counts[2],"waren nicht bereits Teil des ciruclar Codes."))
print(paste("Davon wurden",counts[3],"ersetzt durch Codons, welche Teil des cirular Codes sind."))
print(paste(counts[4],"sind CC-Codons anderer als der ursprünglichen Aminosäure"))

fileConn = file("output.txt") #newSequence to txt file
writeLines(newSequence, fileConn) 
close(fileConn)
```

