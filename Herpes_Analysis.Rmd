---
title: "Herpes_Analysis"
output: html_document
---

```{r include=FALSE}
library("seqinr")
library("ggplot2")
library("ccmotif") # Version 0.6.6
library("Biostrings")
library("knitr")
source("Parameter.R")
```

For Herpes following circular codes showed a high code usage in the unmodified sequence and have therefore been chosen to further look into:

circular codes for frame 0 = 172,173,23 #X23 part of Top 3
circular codes for frame 1 = 191,42,126,23
circular codes for frame 2 = 210,89,88,23

Note that circular code 23 is not part of the Top 3 in frame 1 and 2. But because of an overall good result regarding code usage in all tested organisms, it's part of the selection.
```{r echo=FALSE}
# cid23 = 23 # code ID
# cid1 = 117 # code ID
# cid2 = 22 # code ID

file ="cds/ena-herpes.fasta"

file172_0 = "output_sequences/output_Herpes_X172_frame_0.fasta"
file173_0 = "output_sequences/output_Herpes_X173_frame_0.fasta"
file23_0 = "output_sequences/output_Herpes_X23_frame_0.fasta"

file191_1 = "output_sequences/output_Herpes_X191_frame_1.fasta"
file42_1 = "output_sequences/output_Herpes_X42_frame_1.fasta"
file126_1 = "output_sequences/output_Herpes_X126_frame_1.fasta"
file23_1 = "output_sequences/output_Herpes_X23_frame_1.fasta"

file210_2 = "output_sequences/output_Herpes_X210_frame_2.fasta"
file89_2 = "output_sequences/output_Herpes_X89_frame_2.fasta"
file88_2 = "output_sequences/output_Herpes_X88_frame_2.fasta"
file23_2 = "output_sequences/output_Herpes_X23_frame_2.fasta"

seqLabel = "Herpes"
#seqLabel = paste("Herpes", cid, sep = "/")
ff = read.fasta(file, as.string = TRUE, forceDNAtolower = FALSE)

ff172_0 = read.fasta(file172_0, as.string = TRUE, forceDNAtolower = FALSE)
ff173_0 = read.fasta(file173_0, as.string = TRUE, forceDNAtolower = FALSE)
ff23_0= read.fasta(file23_0, as.string = TRUE, forceDNAtolower = FALSE)

ff191_1 = read.fasta(file191_1, as.string = TRUE, forceDNAtolower = FALSE)
ff42_1 = read.fasta(file42_1, as.string = TRUE, forceDNAtolower = FALSE)
ff126_1 = read.fasta(file126_1, as.string = TRUE, forceDNAtolower = FALSE)
ff23_1 = read.fasta(file23_1, as.string = TRUE, forceDNAtolower = FALSE)

ff210_2 = read.fasta(file210_2, as.string = TRUE, forceDNAtolower = FALSE)
ff89_2 = read.fasta(file89_2, as.string = TRUE, forceDNAtolower = FALSE)
ff88_2 = read.fasta(file88_2, as.string = TRUE, forceDNAtolower = FALSE)
ff23_2 = read.fasta(file23_2, as.string = TRUE, forceDNAtolower = FALSE)

rds172_0 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X172_frame_0.RDS")
rds173_0 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X173_frame_0.RDS")
rds23_0 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X23_frame_0.RDS")

rds191_1 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X191_frame_1.RDS")
rds42_1 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X42_frame_1.RDS")
rds126_1 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X126_frame_1.RDS")
rds23_1 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X23_frame_1.RDS")

rds210_2 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X210_frame_2.RDS")
rds89_2 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X89_frame_2.RDS")
rds88_2 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X88_frame_2.RDS")
rds23_2 <- readRDS("D:/Projekte/BA Circular Code/output_matrixes_codons/codons_outputMatrix_Herpes_X23_frame_2.RDS")
```

Number of bases in frame 0, frame 1 and frame 2 for X23-modified sequence 
Frame 1 and 2 are missing 1 codon in each sequence. At `r length(ff)` sequences in this set, the number of bases should be `r length(ff)*3` less compared to frame 0.
```{r echo=FALSE}
sum(sapply(ff, nchar))
sum(sapply(ff23_0, nchar))
sum(sapply(ff23_1, nchar))
sum(sapply(ff23_2, nchar))
```
This is the codon distribution for sequences in frame 0:
```{r echo=FALSE}
codons = codon.splitlist(ff)
cu = codon.usage(codons)
plot(cu, species = "Herpes - original sequence")

codons172_0 = codon.splitlist(ff172_0)
cu172_0 = codon.usage(codons172_0)
plot(cu172_0, species = "Herpes - X172 Frame 0")

codons173_0 = codon.splitlist(ff173_0)
cu173_0 = codon.usage(codons173_0)
plot(cu173_0, species = "Herpes - X173 Frame 0")

codons23_0 = codon.splitlist(ff23_0)
cu23_0 = codon.usage(codons23_0)
plot(cu23_0, species = "Herpes - X23 Frame 0")
```
This is the codon distribution for sequences in frame 1:
```{r echo=FALSE}
codons191_1 = codon.splitlist(ff191_1)
cu191_1 = codon.usage(codons191_1)
plot(cu191_1, species = "Herpes - X191 Frame 1")

codons42_1 = codon.splitlist(ff42_1)
cu42_1 = codon.usage(codons42_1)
plot(cu42_1, species = "Herpes - X42 Frame 1")

codons126_1 = codon.splitlist(ff126_1)
cu126_1 = codon.usage(codons126_1)
plot(cu126_1, species = "Herpes - X126 Frame 1")

codons23_1 = codon.splitlist(ff23_1)
cu23_1 = codon.usage(codons23_1)
plot(cu23_1, species = "Herpes - X23 Frame 1")
```
This is the codon distribution for sequences in frame 2:
```{r echo=FALSE}
codons210_2 = codon.splitlist(ff210_2)
cu210_2 = codon.usage(codons210_2)
plot(cu210_2, species = "Herpes - X210 Frame 2")

codons89_2 = codon.splitlist(ff89_2)
cu89_2 = codon.usage(codons89_2)
plot(cu89_2, species = "Herpes - X89 Frame 2")

codons88_2 = codon.splitlist(ff88_2)
cu88_2 = codon.usage(codons88_2)
plot(cu88_2, species = "Herpes - X88 Frame 2")

codons23_2 = codon.splitlist(ff23_2)
cu23_2 = codon.usage(codons23_2)
plot(cu23_2, species = "Herpes - X23 Frame 2")
```

Code Usage:
```{r echo=FALSE}
code23 = codes.c3[[23]]

p = codes.usage(cu, code23)
paste("x23 original:",round(p, 2))

p172_0 = codes.usage(cu172_0, codes.c3[[172]])
paste("x172 frame 0:",round(p172_0, 2)) 

p173_0 = codes.usage(cu173_0, codes.c3[[173]])
paste("x173 frame 0:",round(p173_0, 2)) 

p23_0 = codes.usage(cu23_0, code23)
paste("x23 frame 0:",round(p23_0, 2)) 

p191_1 = codes.usage(cu191_1, codes.c3[[191]])
paste("x191 frame 1:",round(p191_1, 2)) 

p42_1 = codes.usage(cu42_1, codes.c3[[42]])
paste("x42 frame 1:",round(p42_1, 2)) 

p126_1 = codes.usage(cu126_1, codes.c3[[126]])
paste("x126 frame 1:",round(p126_1, 2)) 

p23_1 = codes.usage(cu23_1, code23)
paste("x23 frame 1:",round(p23_1, 2)) 

p210_2 = codes.usage(cu210_2, codes.c3[[210]])
paste("x210 frame 2:",round(p210_2, 2)) 

p89_2 = codes.usage(cu89_2, codes.c3[[89]])
paste("x89 frame 2:",round(p89_2, 2)) 

p88_2 = codes.usage(cu88_2, codes.c3[[88]])
paste("x88 frame 2:",round(p88_2, 2)) 

p23_2 = codes.usage(cu23_2, code23)
paste("x23 frame 2:",round(p23_2, 2)) 

```

Codons in these sequences:
```{r}
ca23_0 = sum(rds23_0)
ca23_0

ca172_0 = sum(rds172_0)
ca172_0

ca173_0 = sum(rds173_0)
ca173_0

ca191_1 = sum(rds191_1)
ca191_1

ca42_1 = sum(rds42_1)
ca42_1

ca126_1 = sum(rds126_1)
ca126_1

ca23_1 = sum(rds23_1)
ca23_1

ca210_2 = sum(rds210_2)
ca210_2

ca89_2 = sum(rds89_2)
ca89_2

ca88_2 = sum(rds88_2)
ca88_2

ca23_2 = sum(rds23_2)
ca23_2
```

Unchanged codons: 
```{r}
nc23_0 = sum(diag(rds23_0))
nc23_0

nc172_0 = sum(diag(rds172_0))
nc173_0 = sum(diag(rds173_0))

nc191_1 = sum(diag(rds191_1))
nc42_1 = sum(diag(rds42_1))
nc126_1 = sum(diag(rds126_1))

nc23_1 = sum(diag(rds23_1))
nc23_1

nc210_2 = sum(diag(rds210_2))
nc89_2 = sum(diag(rds89_2))
nc88_2 = sum(diag(rds88_2))

nc23_2 = sum(diag(rds23_2))
nc23_2
```

Changed Codons:
```{r}
cc23_0 = ca23_0-nc23_0
cc23_0

cc172_0 = ca172_0-nc172_0
cc173_0 = ca173_0-nc173_0

cc191_1 = ca191_1-nc191_1
cc42_1 = ca42_1-nc42_1
cc126_1 = ca126_1-nc126_1

cc23_1 = ca23_1-nc23_1
cc23_1

cc210_2 = ca210_2-nc210_2
cc89_2 = ca89_2-nc89_2
cc88_2 = ca88_2-nc88_2

cc23_2 = ca23_2-nc23_2
cc23_2
```
% codons changed
```{r}
ccp23_0 =cc23_0/ca23_0
round(ccp23_0,2)

ccp172_0 =cc172_0/ca172_0
ccp173_0 =cc173_0/ca173_0

ccp191_1 =cc191_1/ca191_1
ccp42_1 =cc42_1/ca42_1
ccp126_1 =cc126_1/ca126_1

ccp23_1 =cc23_1/ca23_1
round(ccp23_1,2)

ccp210_2 =cc210_2/ca210_2
ccp89_2 =cc89_2/ca89_2
ccp88_2 =cc88_2/ca88_2

ccp23_2 =cc23_2/ca23_2
round(ccp23_2,2)
```
Difference of cu in original sequence and code usage in modified sequence (should be equal to % codons changed):
```{r}
round(p23_0-p,2)
round(p23_1-p,2)
round(p23_2-p,2)
```
Amount of codons that could not be changed. Percent of all codons. 
```{r}
unc23_0 = unchangednonCCCodons(rds23_0,codes.c3[[23]])
unc23_0
round(unc23_0/ca23_0, 2)

unc172_0 = unchangednonCCCodons(rds172_0,codes.c3[[172]])
unc173_0 = unchangednonCCCodons(rds173_0,codes.c3[[173]])

unc191_1 = unchangednonCCCodons(rds191_1,codes.c3[[191]])
unc42_1 = unchangednonCCCodons(rds42_1,codes.c3[[42]])
unc126_1 = unchangednonCCCodons(rds126_1,codes.c3[[126]])

unc23_1 = unchangednonCCCodons(rds23_1,codes.c3[[23]])
unc23_1
round(unc23_1/ca23_1, 2)

unc210_2 = unchangednonCCCodons(rds210_2,codes.c3[[210]])
unc89_2 = unchangednonCCCodons(rds89_2,codes.c3[[89]])
unc88_2 = unchangednonCCCodons(rds88_2,codes.c3[[88]])

unc23_2 = unchangednonCCCodons(rds23_2,codes.c3[[23]])
unc23_2
round(unc23_2/ca23_2, 2)
```
Rating for codons that did not need to be changed, because they already were part of the circular code:
10
Rating for the modified sequences:
Base 1 the same +4
Base 2 the same +4
Base 3 the same +2
1/2/3 not the same, but purin/purin or pyrimidin/pyrimidin change +1

Sum of both ratings is multiplied with the amount of circular codes in the new sequence (code usage). 
Logarithm to center score around 0. Max. score is 1. Worst score is -1

Which leads to this edit score and edit distance for following sequences:
```{r}
editScore23_0 = getEditScore(rds23_0)
round(editScore23_0,4)
editDistance23_0 = getEditDistance(rds23_0,editScore23_0,code23)
round(editDistance23_0,2)

editScore172_0 = getEditScore(rds172_0)
editDistance172_0 = getEditDistance(rds172_0,editScore172_0,codes.c3[[172]])
editScore173_0 = getEditScore(rds173_0)
editDistance173_0 = getEditDistance(rds173_0,editScore173_0,codes.c3[[173]])

editScore191_1 = getEditScore(rds191_1)
editDistance191_1 = getEditDistance(rds191_1,editScore191_1,codes.c3[[191]])
editScore42_1 = getEditScore(rds42_1)
editDistance42_1 = getEditDistance(rds42_1,editScore42_1,codes.c3[[42]])
editScore126_1 = getEditScore(rds126_1)
editDistance126_1 = getEditDistance(rds126_1,editScore126_1,codes.c3[[126]])

editScore23_1 = getEditScore(rds23_1)
round(editScore23_1,4)
editDistance23_1 = getEditDistance(rds23_1,editScore23_1,code23)
round(editDistance23_1,2)


editScore210_2 = getEditScore(rds210_2)
editDistance210_2 = getEditDistance(rds210_2,editScore210_2,codes.c3[[210]])
editScore89_2 = getEditScore(rds89_2)
editDistance89_2 = getEditDistance(rds89_2,editScore89_2,codes.c3[[89]])
editScore88_2 = getEditScore(rds88_2)
editDistance88_2 = getEditDistance(rds88_2,editScore88_2,codes.c3[[88]])

editScore23_2 = getEditScore(rds23_2)
round(editScore23_2,4)
editDistance23_2 = getEditDistance(rds23_2,editScore23_2,code23)
round(editDistance23_2,2)
```

Summary for X23 frame 0:
```{r}
paste("Codons in set:", ca23_0)
paste("----- changed:", cc23_0, "(", round(cc23_0/ca23_0,2),")")
paste("----- not changed:", nc23_0, "(", round(nc23_0/ca23_0,2),")")
paste("----- not changed because no good substitute:", unc23_0, "(", round(unc23_0/ca23_0,2),")")
paste("----- not changed because already part of circular code:", nc23_0-unc23_0, "(", round((nc23_0-unc23_0)/ca23_0,2),")", "| note: code usage in original sequence:", round(p,2))
paste("Score:",round(editScore23_0,2))
```
Summary for X23 frame 1:
```{r}
paste("Codons in set:", ca23_1)
paste("----- changed:", cc23_1, "(", round(cc23_1/ca23_1,2),")")
paste("----- not changed:", nc23_1, "(", round(nc23_1/ca23_1,2),")")
paste("----- not changed because no good substitute:", unc23_1, "(", round(unc23_1/ca23_1,2),")")
paste("----- not changed because already part of circular code:", nc23_1-unc23_1, "(", round((nc23_1-unc23_1)/ca23_1,2),")", "| note: code usage in original sequence:", round(p,2))
paste("Score:",round(editScore23_1,2))
```

Summary for X23 frame 2:
```{r}
paste("Codons in set:", ca23_2)
paste("----- changed:", cc23_2, "(", round(cc23_2/ca23_2,2),")")
paste("----- not changed:", nc23_2, "(", round(nc23_2/ca23_2,2),")")
paste("----- not changed because no good substitute:", unc23_2, "(", round(unc23_2/ca23_2,2),")")
paste("----- not changed because already part of circular code:", nc23_2-unc23_2, "(", round((nc23_2-unc23_2)/ca23_2,2),")", "| note: code usage in original sequence:", round(p,2))
paste("Score:",round(editScore23_2,2))
```


Summary Herpes Virus: 
```{r}
changed = c(cc23_0,cc172_0,cc173_0,
            cc191_1,cc42_1,cc126_1,cc23_1,
            cc210_2,cc89_2,cc88_2,cc23_2)
ch = c(round(cc23_0/ca23_0,2),round(cc172_0/ca172_0,2),round(cc173_0/ca173_0,2),
       round(cc191_1/ca191_1,2),round(cc42_1/ca42_1,2),round(cc126_1/ca126_1,2),round(cc23_1/ca23_1,2),
       round(cc210_2/ca210_2,2),round(cc89_2/ca89_2,2),round(cc88_2/ca88_2,2),round(cc23_2/ca23_2,2))
not_changed = c(nc23_0, nc172_0, nc173_0,
                nc191_1, nc42_1, nc126_1, nc23_1,
                nc210_2, nc89_2, nc88_2, nc23_2)
not_ch = c(round(nc23_0/ca23_0,2),round(nc172_0/ca172_0,2),round(nc173_0/ca173_0,2),
           round(nc191_1/ca191_1,2),round(nc42_1/ca42_1,2),round(nc126_1/ca126_1,2),round(nc23_1/ca23_1,2),
           round(nc210_2/ca210_2,2), round(nc89_2/ca89_2,2), round(nc88_2/ca88_2,2), round(nc23_2/ca23_2,2))
not_possible = c(unc23_0,unc172_0,unc173_0,
                 unc191_1,unc42_1,unc126_1,unc23_1,
                 unc210_2,unc89_2,unc88_2,unc23_2)
not_p = c(round(unc23_0/ca23_0,2),round(unc172_0/ca172_0,2),round(unc173_0/ca173_0,2),
          round(unc191_1/ca191_1,2),round(unc42_1/ca42_1,2),round(unc126_1/ca126_1,2),round(unc23_1/ca23_1,2),
          round(unc210_2/ca210_2,2),round(unc89_2/ca89_2,2),round(unc88_2/ca88_2,2),round(unc23_2/ca23_2,2))
not_needed = c(nc23_0-unc23_0,nc172_0-unc172_0,nc173_0-unc173_0,
               nc191_1-unc191_1,nc42_1-unc42_1,nc126_1-unc126_1,nc23_1-unc23_1,
               nc210_2-unc210_2,nc89_2-unc89_2,nc88_2-unc88_2,nc23_2-unc23_2)
not_n = c(round((nc23_0-unc23_0)/ca23_0,2),round((nc172_0-unc172_0)/ca172_0,2),round((nc173_0-unc173_0)/ca173_0,2),
          round((nc191_1-unc191_1)/ca191_1,2),round((nc42_1-unc42_1)/ca42_1,2),round((nc126_1-unc126_1)/ca126_1,2),round((nc23_1-unc23_1)/ca23_1,2),
          round((nc210_2-unc210_2)/ca210_2,2),round((nc89_2-unc89_2)/ca89_2,2),round((nc88_2-unc88_2)/ca88_2,2),round((nc23_2-unc23_2)/ca23_2,2))
editScore = c(round(editScore23_0,4),round(editScore172_0,4),round(editScore173_0,4),
            round(editScore191_1,4),round(editScore42_1,4),round(editScore126_1,4),round(editScore23_1,4),
            round(editScore210_2,4),round(editScore89_2,4),round(editScore88_2,4),round(editScore23_2,4))
editDistance = c(round(editDistance23_0,2),round(editDistance172_0,2),round(editDistance173_0,2),
            round(editDistance191_1,2),round(editDistance42_1,2),round(editDistance126_1,2),round(editDistance23_1,2),
            round(editDistance210_2,2),round(editDistance89_2,2),round(editDistance88_2,2),round(editDistance23_2,2))

rows = c("23_0","172_0","173_0",
         "191_1","42_1","126_1","23_1",
         "210_2","89_2","88_2","23_2")


df = data.frame(changed,ch,not_changed,not_ch,not_possible,not_p,not_needed,not_n,editScore,editDistance,
                row.names = rows)

kable(
  df,
  caption = paste("Summary for Herpes Virus x23 || original codon usage (x23):",round(p,2))
)
```






